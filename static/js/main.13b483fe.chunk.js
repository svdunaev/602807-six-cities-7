(this.webpackJsonpproject=this.webpackJsonpproject||[]).push([[0],{71:function(e,t,r){"use strict";r.r(t),r.d(t,"api",(function(){return nt}));var a=r(1),n=r.n(a),c=r(21),s=r.n(c),i=r(6),o=r(8),l=r(4),u={CHANGE_CITY:"citySelect/changeCity",SET_OFFERS:"citySelect/setOffers",SET_OFFERS_FAIL:"citySelect/setOffersFail",CHANGE_SORT_TYPE:"sort/changeSortType",LOGIN:"user/login",LOGOUT:"user/logout",REDIRECTTOROUTE:"redirect/redirectToRoute",SET_COMMENTS:"data/setComments",SET_APP_ERROR:"app/setError"},d=function(e){return{type:u.CHANGE_CITY,payload:e}},j=function(e){return{type:u.SET_OFFERS,payload:e}},b=function(){return{type:u.SET_OFFERS_FAIL}},p=function(e){return{type:u.CHANGE_SORT_TYPE,payload:e}},m=function(e){return{type:u.REDIRECTTOROUTE,payload:e}},h=function(e){return{type:u.LOGIN,payload:e}},O=function(){return{type:u.LOGOUT}},_=function(){return{type:u.SET_APP_ERROR}},f="apartment",v="room",x="house",g="hotel",y="studio",N={POPULAR:"Popular",PRICE_LOW_TO_HIGH:"Price: low to high",PRICE_HIGH_TO_LOW:"Price: high to low",TOP_RATED_FIRST:"Top rated first"},w="/",R="/login",S="/favorites",k="/offer",E="/hotels",T="/login",C="/logout",L="/comments",F="/favorite",I="AUTH",P="NO_AUTH",z="UNKNOWN",A=["Amsterdam","Cologne","Dusseldorf","Paris","Brussels","Hamburg"],M=r(3),q=function(e){var t=Object(M.a)(Object(M.a)({},e),{},{maxAdults:e.max_adults,previewImage:e.preview_image,isFavorite:e.is_favorite,isPremium:e.is_premium,host:{avatarUrl:e.host.avatar_url,id:e.host.id,isPro:e.host.is_pro,name:e.host.name}});return delete t.max_adults,delete t.preview_image,delete t.is_favorite,delete t.is_premium,t},H=function(e){return Object(M.a)(Object(M.a)({},e),{},{user:{avatarUrl:e.user.avatar_url,id:e.user.id,isPro:e.user.is_pro,name:e.user.name}})},U=function(e){var t=Object(M.a)(Object(M.a)({},e),{},{avatarUrl:e.avatar_url,isPro:e.is_pro});return delete t.avatar_url,delete t.is_pro,t},D=function(){return function(e,t,r){return r.get(E).then((function(e){return e.data.map((function(e){return q(e)}))})).then((function(t){return e(j(t))})).catch((function(){return e(b())}))}},G=function(e){return nt.get("".concat(E,"/").concat(e)).then((function(e){var t=e.data;return q(t)}))},B=function(e){return nt.get("".concat(E,"/").concat(e,"/nearby")).then((function(e){return e.data.map((function(e){return q(e)}))}))},W=function(){return function(e,t,r){return r.delete(C).then((function(){return localStorage.removeItem("token")})).then((function(){return e(O())}))}},Y=function(e,t){nt.post("".concat(F,"/").concat(e,"/").concat(t)).then((function(e){var t=e.data;return q(t)}))},V=r(0);var J=Object(l.b)((function(e){var t=e.authorizationStatus,r=e.userInfo;return{authorizationStatus:t,avatar:r.avatarUrl,email:r.email}}),(function(e){return{onSignOutClick:function(){e(W())}}}))((function(e){var t=e.authorizationStatus,r=e.onSignOutClick,a=e.avatar,n=e.email,c=t===I;return Object(V.jsx)("header",{className:"header",children:Object(V.jsx)("div",{className:"container",children:Object(V.jsxs)("div",{className:"header__wrapper",children:[Object(V.jsx)("div",{className:"header__left",children:Object(V.jsx)(o.a,{className:"header__logo-link header__logo-link--active",to:"/",children:Object(V.jsx)("img",{className:"header__logo",src:"img/logo.svg",alt:"6 cities logo",width:"81",height:"41"})})}),Object(V.jsx)("nav",{className:"header__nav",children:Object(V.jsxs)("ul",{className:"header__nav-list",children:[Object(V.jsx)("li",{className:"header__nav-item user",children:Object(V.jsxs)(o.a,{className:"header__nav-link header__nav-link--profile",to:c?S:R,children:[Object(V.jsx)("div",{className:"header__avatar-wrapper user__avatar-wrapper",style:c?{backgroundImage:"url(".concat(a,")"),borderRadius:"10px"}:{}}),c?Object(V.jsx)("span",{className:"header__user-name user__name",children:n}):Object(V.jsx)("span",{className:"header__login",children:"Sign in"})]})}),c&&Object(V.jsx)("li",{className:"header__nav-item",children:Object(V.jsx)(o.a,{className:"header__nav-link",to:"#",onClick:r,children:Object(V.jsx)("span",{className:"header__signout",children:"Sign out"})})})]})})]})})})})),Z=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;var K=Object(l.b)(null,(function(e){return{onSubmit:function(t){e(function(e){return function(t,r,a){return a.post(T,e).then((function(e){var r=e.data;localStorage.setItem("token",r.token),t(h(U(r)))})).then((function(){return t(m(w))}))}}(t))}}}))((function(e){var t=e.onSubmit,r=Object(a.useRef)(),n=Object(a.useRef)();return Object(V.jsxs)("div",{className:"page page--gray page--login",children:[Object(V.jsx)(J,{}),Object(V.jsx)("main",{className:"page__main page__main--login",children:Object(V.jsxs)("div",{className:"page__login-container container",children:[Object(V.jsxs)("section",{className:"login",children:[Object(V.jsx)("h1",{className:"login__title",children:"Sign in"}),Object(V.jsxs)("form",{className:"login__form form",action:"",onSubmit:function(e){e.preventDefault(),t({email:r.current.value,password:n.current.value})},children:[Object(V.jsxs)("div",{className:"login__input-wrapper form__input-wrapper",children:[Object(V.jsx)("label",{className:"visually-hidden",children:"E-mail"}),Object(V.jsx)("input",{className:"login__input form__input",type:"email",name:"email",placeholder:"Email",ref:r,onInput:function(){var e=r.current.value,t="";e&&Z.test(e)||(t="\u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u044b\u0439 email"),r.current.setCustomValidity(t),r.current.reportValidity()},required:!0})]}),Object(V.jsxs)("div",{className:"login__input-wrapper form__input-wrapper",children:[Object(V.jsx)("label",{className:"visually-hidden",children:"Password"}),Object(V.jsx)("input",{className:"login__input form__input",type:"password",name:"password",placeholder:"Password",ref:n,onInput:function(){var e=n.current.value,t="";e&&!Array.from(e).find((function(e){return" "!==e}))&&(t="\u041f\u0430\u0440\u043e\u043b\u044c \u043d\u0435 \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u043e\u0441\u0442\u043e\u044f\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0438\u0437 \u043f\u0440\u043e\u0431\u0435\u043b\u043e\u0432"),n.current.setCustomValidity(t),n.current.reportValidity()},required:!0})]}),Object(V.jsx)("button",{className:"login__submit form__submit button",type:"submit",children:"Sign in"})]})]}),Object(V.jsx)("section",{className:"locations locations--login locations--current",children:Object(V.jsx)("div",{className:"locations__item",children:Object(V.jsx)(o.a,{className:"locations__item-link",to:"#",style:{cursor:"default"},children:Object(V.jsx)("span",{children:"Amsterdam"})})})})]})})]})})),$=r(14),Q=r.n($),X=r(16),ee=r(7),te=r(2),re=r.n(te),ae=(re.a.exact({bedrooms:re.a.number.isRequired,location:re.a.exact({latitude:re.a.number,longitude:re.a.number,zoom:re.a.number}).isRequired,city:re.a.exact({location:re.a.exact({latitude:re.a.number,longitude:re.a.number,zoom:re.a.number}),name:re.a.string}).isRequired,description:re.a.string.isRequired,goods:re.a.arrayOf(re.a.string).isRequired,host:re.a.exact({avatarUrl:re.a.string,id:re.a.number,isPro:re.a.bool,name:re.a.string}).isRequired,id:re.a.number.isRequired,images:re.a.arrayOf(re.a.string).isRequired,price:re.a.number.isRequired,rating:re.a.number.isRequired,type:re.a.oneOf([f,g,x,v,y]).isRequired,isPremium:re.a.bool.isRequired,isFavorite:re.a.bool.isRequired,title:re.a.string.isRequired,maxAdults:re.a.number.isRequired,previewImage:re.a.string.isRequired}),re.a.exact({comment:re.a.string.isRequired,date:re.a.string.isRequired,id:re.a.number.isRequired,rating:re.a.number.isRequired,user:re.a.shape({avatarUrl:re.a.string.isRequired,id:re.a.number.isRequired,isPro:re.a.bool.isRequired,name:re.a.string.isRequired})}),function(e){return Math.round(e)/5*100});function ne(e){var t=e.card,r=t.price,n=t.rating,c=t.type,s=t.isPremium,l=t.isFavorite,u=t.previewImage,d=t.id,j=t.title,b=e.rootClassName,p=e.imageWrapperClassName,m=e.infoWrapperClassName,h=e.onHover,O=e.onFavoriteToggle,_=e.authorizationStatus,f=Object(a.useCallback)(Object(X.a)(Q.a.mark((function e(){return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y(d,Number(!l));case 2:setTimeout(O,300);case 3:case"end":return e.stop()}}),e)}))),[d,l,O]),v=Object(i.g)();return Object(V.jsxs)("article",{className:"place-card ".concat(b),onMouseEnter:function(t){h&&h(e.card)},onMouseLeave:function(){h&&h(null)},children:[s&&Object(V.jsx)("div",{className:"place-card__mark",children:Object(V.jsx)("span",{children:"Premium"})}),Object(V.jsx)("div",{className:"place-card__image-wrapper ".concat(p),children:Object(V.jsx)("img",{className:"place-card__image",src:u,style:{width:"260px",height:"200px"},alt:"Place"})}),Object(V.jsxs)("div",{className:"place-card__info ".concat(m),children:[Object(V.jsxs)("div",{className:"place-card__price-wrapper",children:[Object(V.jsxs)("div",{className:"place-card__price",children:[Object(V.jsxs)("b",{className:"place-card__price-value",children:["\u20ac",r]}),Object(V.jsx)("span",{className:"place-card__price-text",children:"/\xa0night"})]}),Object(V.jsxs)("button",{className:"place-card__bookmark-button ".concat(l?"place-card__bookmark-button--active":""," button"),type:"button",onClick:function(e){e.preventDefault(),_===P&&v.push(R),f()},children:[Object(V.jsx)("svg",{className:"place-card__bookmark-icon",width:"18",height:"19",children:Object(V.jsx)("use",{xlinkHref:"#icon-bookmark"})}),Object(V.jsx)("span",{className:"visually-hidden",children:"To bookmarks"})]})]}),Object(V.jsx)("div",{className:"place-card__rating rating",children:Object(V.jsxs)("div",{className:"place-card__stars rating__stars",children:[Object(V.jsx)("span",{style:{width:"".concat(ae(n),"%")}}),Object(V.jsx)("span",{className:"visually-hidden",children:n})]})}),Object(V.jsx)(o.a,{to:"/offer/".concat(d),children:Object(V.jsx)("h2",{className:"place-card__name",children:j})}),Object(V.jsx)("p",{className:"place-card__type",children:c})]})]})}ne.defaultProps={rootClassName:"",imageWrapperClassName:"",infoWrapperClassName:""};var ce=Object(l.b)((function(e){return{authorizationStatus:e.authorizationStatus}}))(ne);var se=function(e){var t=e.cityName,r=e.cityOffers,a=e.onFavoriteToggle;return Object(V.jsxs)("li",{className:"favorites__locations-items",children:[Object(V.jsx)("div",{className:"favorites__locations locations locations--current",children:Object(V.jsx)("div",{className:"locations__item",children:Object(V.jsx)("a",{className:"locations__item-link",href:"/#",children:Object(V.jsx)("span",{children:t})})})}),Object(V.jsx)("div",{className:"favorites__places",children:r.map((function(e){return Object(V.jsx)(ce,{card:e,rootClassName:"favorites__card",imageWrapperClassName:"favorites__image-wrapper",infoWrapperClassName:"favorites__card-info",onFavoriteToggle:a},e.id)}))})]})};var ie=function(){return Object(V.jsx)("p",{children:"Loading ..."})};var oe=Object(l.b)(null,(function(e){return{fetchAllOffers:function(){e(D())}}}))((function(e){var t=e.fetchAllOffers,r=Object(a.useState)(!0),c=Object(ee.a)(r,2),s=c[0],i=c[1],l=Object(a.useState)([]),u=Object(ee.a)(l,2),d=u[0],j=u[1],b=Object(a.useCallback)(Object(X.a)(Q.a.mark((function e(){var t;return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nt.get(F).then((function(e){return e.data.map((function(e){return q(e)}))}));case 2:t=e.sent,i(!1),j(t);case 5:case"end":return e.stop()}}),e)}))),[]),p=Object(a.useCallback)((function(){b(),t()}),[t,b]),m=Object(a.useMemo)((function(){return Object.entries(d.reduce((function(e,t){return!0!==t.isFavorite||(t.city.name in e?e[t.city.name].push(t):e[t.city.name]=[t]),e}),[]))}),[d]);return Object(a.useEffect)((function(){b()}),[b]),s?Object(V.jsx)(ie,{}):Object(V.jsxs)(n.a.Fragment,{children:[Object(V.jsx)(J,{}),Object(V.jsx)("div",{style:{display:"none"},children:Object(V.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",children:[Object(V.jsx)("symbol",{id:"icon-arrow-select",viewBox:"0 0 7 4",children:Object(V.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0 0l3.5 2.813L7 0v1.084L3.5 4 0 1.084V0z"})}),Object(V.jsx)("symbol",{id:"icon-bookmark",viewBox:"0 0 17 18",children:Object(V.jsx)("path",{d:"M3.993 2.185l.017-.092V2c0-.554.449-1 .99-1h10c.522 0 .957.41.997.923l-2.736 14.59-4.814-2.407-.39-.195-.408.153L1.31 16.44 3.993 2.185z"})}),Object(V.jsx)("symbol",{id:"icon-star",viewBox:"0 0 13 12",children:Object(V.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.5 9.644L10.517 12 9.451 7.56 13 4.573l-4.674-.386L6.5 0 4.673 4.187 0 4.573 3.549 7.56 2.483 12 6.5 9.644z"})})]})}),Object(V.jsxs)("div",{className:"page",children:[Object(V.jsx)("main",{className:"page__main page__main--favorites",children:Object(V.jsxs)("div",{className:"page__favorites-container container",children:[0===m.length&&Object(V.jsxs)("section",{className:"favorites favorites--empty",children:[Object(V.jsx)("h1",{className:"visually-hidden",children:"Favorites (empty)"}),Object(V.jsxs)("div",{className:"favorites__status-wrapper",children:[Object(V.jsx)("b",{className:"favorites__status",children:"Nothing yet saved."}),Object(V.jsx)("p",{className:"favorites__status-description",children:"Save properties to narrow down search or plan your future trips."})]})]}),m.length>0&&Object(V.jsxs)("section",{className:"favorites",children:[Object(V.jsx)("h1",{className:"favorites__title",children:"Saved listing"}),Object(V.jsx)("ul",{className:"favorites__list",children:m.map((function(e){var t=Object(ee.a)(e,2),r=t[0],a=t[1];return Object(V.jsx)(se,{cityName:r,cityOffers:a,onFavoriteToggle:p},r)}))})]})]})}),Object(V.jsx)("footer",{className:"footer container",children:Object(V.jsx)(o.a,{to:"/",className:"footer__logo-link",children:Object(V.jsx)("img",{className:"footer__logo",src:"img/logo.svg",alt:"6 cities logo",width:"64",height:"33"})})})]})]})})),le=r(18);var ue=Object(l.b)(null,(function(e){return{fetchOffers:function(){e(D())}}}))((function(e){var t=e.offers,r=e.onHover,n=e.fetchOffers,c=e.onFavoriteToggle,s=Object(a.useCallback)((function(){n(),c&&c()}),[n,c]);return Object(V.jsx)("div",{className:"cities__places-list places__list tabs__content",children:t.map((function(e){return Object(V.jsx)(ce,{card:e,rootClassName:"cities__place-card",imageWrapperClassName:"cities__image-wrapper",onHover:r,offers:t,onFavoriteToggle:s},e.id)}))})})),de=r(15),je=r.n(de);r(52);var be=function(e,t){var r=Object(a.useState)(null),n=Object(ee.a)(r,2),c=n[0],s=n[1],i=Object(a.useState)(null),o=Object(ee.a)(i,2),l=o[0],u=o[1];return Object(a.useEffect)((function(){if(null!==e.current&&null===c){var r=je.a.map(e.current,{center:{lat:t.location.latitude,lng:t.location.longitude},zoom:t.location.zoom});je.a.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'}).addTo(r),s(r),u(je.a.layerGroup().addTo(r))}}),[e,t,c]),[c,l]},pe=je.a.icon({iconUrl:"/img/pin.svg",iconSize:[25,35],iconAnchor:[15,30]}),me=je.a.icon({iconUrl:"img/pin-active.svg",iconSize:[25,35],iconAnchor:[15,30]});var he=function(e){var t=e.city,r=e.points,n=e.activeCard,c=Object(a.useRef)(null),s=be(c,t),i=Object(ee.a)(s,2),o=i[0],l=i[1];return Object(a.useEffect)((function(){o&&(l.clearLayers(),o.flyTo([t.location.latitude,t.location.longitude],t.location.zoom),r.forEach((function(e){je.a.marker({lat:e.location.latitude,lng:e.location.longitude},{icon:e===n?me:pe}).addTo(l)})))}),[l,r,n,t,o]),Object(V.jsx)("div",{style:{height:"100%"},ref:c})},Oe=r(24),_e=r.n(Oe),fe=function(e,t){return _e()(e).format(t)},ve="YYYY-MM-DD",xe="MMMM YYYY";var ge=function(e){var t=e.review;return Object(V.jsxs)("li",{className:"reviews__item",children:[Object(V.jsxs)("div",{className:"reviews__user user",children:[Object(V.jsx)("div",{className:"reviews__avatar-wrapper user__avatar-wrapper",children:Object(V.jsx)("img",{className:"reviews__avatar user__avatar",src:t.user.avatarUrl,width:"54",height:"54",alt:"Reviews avatar"})}),Object(V.jsx)("span",{className:"reviews__user-name",children:t.user.name})]}),Object(V.jsxs)("div",{className:"reviews__info",children:[Object(V.jsx)("div",{className:"reviews__rating rating",children:Object(V.jsxs)("div",{className:"reviews__stars rating__stars",children:[Object(V.jsx)("span",{style:{width:"".concat(ae(t.rating),"%")},children:"\xa0"}),Object(V.jsx)("span",{className:"visually-hidden",children:"Rating"})]})}),Object(V.jsx)("p",{className:"reviews__text",children:t.comment}),Object(V.jsx)("time",{className:"reviews__time",dateTime:fe(t.date,ve),children:fe(t.date,xe)})]})]})};var ye=function(e){var t=e.reviews,r=Object(a.useMemo)((function(){var e=t.slice().sort((function(e,t){return r=t.date,a=e.date,_e()(r).diff(_e()(a));var r,a}));return e.length>10?e.slice(0,10):e}),[t]);return Object(V.jsxs)(n.a.Fragment,{children:[Object(V.jsxs)("h2",{className:"reviews__title",children:["Reviews \xb7 ",Object(V.jsxs)("span",{className:"reviews__amount",children:[r.length," "]})]}),Object(V.jsx)("ul",{className:"reviews__list",children:r.map((function(e){return Object(V.jsx)(ge,{review:e},e.id)}))})]})};var Ne=function(e){var t=e.value,r=e.title,a=e.isDisabled,n=e.currentRatingValue,c=e.changeHandler;return Object(V.jsxs)(V.Fragment,{children:[Object(V.jsx)("input",{className:"form__rating-input visually-hidden",name:"rating",value:t,id:"".concat(t,"-stars"),type:"radio",onChange:c,checked:n===t,disabled:a}),Object(V.jsx)("label",{htmlFor:"".concat(t,"-stars"),className:"reviews__rating-label form__rating-label",title:r,children:Object(V.jsx)("svg",{className:"form__star-image",width:"37",height:"33",children:Object(V.jsx)("use",{xlinkHref:"#icon-star"})})})]})};function we(){return Object(V.jsxs)(V.Fragment,{children:["To submit review please make sure to set ",Object(V.jsx)("span",{className:"reviews__star",children:"rating"})," and describe your stay with at least ",Object(V.jsx)("b",{className:"reviews__text-amount",children:"50 characters"}),"."]})}function Re(){return Object(V.jsx)("span",{style:{color:"red"},children:"Err ocured, try again."})}var Se=50,ke=300,Ee={1:"terribly",2:"badly",3:"not bad",4:"good",5:"perfect"};var Te=Object(l.b)((function(e){return{authorizationStatus:e.authorizationStatus}}),(function(e){return{sendReview:function(t,r){return e(function(e,t){return function(r,a,n){return n.post("".concat(L,"/").concat(e),t).then((function(e){return e.data.map((function(e){return H(e)}))}))}}(t,r))}}}))((function(e){var t=e.authorizationStatus,r=e.offerId,n=e.sendReview,c=e.updateReviewsList,s={rating:"",comment:"",isBlocked:!1,isNeedErrorMessage:!1},i=Object(a.useState)(s),o=Object(ee.a)(i,2),l=o[0],u=o[1],d=l.rating,j=l.comment,b=l.isBlocked,p=l.isNeedErrorMessage;if(!(t===I))return null;var m=d&&j.length>Se&&j.length<ke;return Object(V.jsxs)("form",{className:"reviews__form form",action:"#",onSubmit:function(e){e.preventDefault();var t={comment:j,rating:d};u((function(e){return Object(M.a)(Object(M.a)({},e),{},{isBlocked:!0})})),n(r,t).then((function(e){return c(e)})).then((function(){return u(s)})).catch((function(){return u((function(e){return Object(M.a)(Object(M.a)({},e),{},{isNeedErrorMessage:!0})})),void setTimeout((function(){u((function(e){return Object(M.a)(Object(M.a)({},e),{},{isNeedErrorMessage:!1,isBlocked:!1})}))}),5e3)}))},children:[Object(V.jsx)("label",{className:"reviews__label form__label",htmlFor:"review",children:"Your review"}),Object(V.jsx)("div",{className:"reviews__rating-form form__rating",children:Object.keys(Ee).sort((function(e,t){return t-e})).map((function(e){return Object(V.jsx)(Ne,{value:e,title:Ee[e],currentRatingValue:d,changeHandler:function(e){var t=e.target;return u((function(e){return Object(M.a)(Object(M.a)({},e),{},{rating:t.value})}))},isDisabled:b},e)}))}),Object(V.jsx)("textarea",{className:"reviews__textarea form__textarea",id:"review",name:"review",placeholder:"Tell how was your stay, what you like and what can be improved",value:j,required:!0,onChange:function(e){var t=e.target;return u((function(e){return Object(M.a)(Object(M.a)({},e),{},{comment:t.value})}))},disabled:b}),Object(V.jsxs)("div",{className:"reviews__button-wrapper",children:[Object(V.jsx)("p",{className:"reviews__help",children:p?Object(V.jsx)(Re,{}):Object(V.jsx)(we,{})}),Object(V.jsx)("button",{className:"reviews__submit form__submit button",type:"submit",disabled:!m||b,children:"Submit"})]})]})}));var Ce=function(){return Object(V.jsx)("p",{children:"loading"})};var Le=Object(l.b)(null,(function(e){return{loadReviews:function(t){return e(function(e){return function(t,r,a){return a.get("".concat(L,"/").concat(e)).then((function(e){return e.data.map((function(e){return H(e)}))}))}}(t))}}}))((function(e){var t=e.offerId,r=e.loadReviews,n=Object(a.useState)({isLoading:!0,reviews:[],isLoadingError:!1}),c=Object(ee.a)(n,2),s=c[0],i=c[1],o=s.isLoading,l=s.reviews,u=s.isLoadingError;return Object(a.useEffect)((function(){r(t).then((function(e){return i({isLoading:!1,reviews:e,isLoadingError:!1})})).catch((function(){return i({isLoading:!1,reviews:[],isLoadingError:!0})}))}),[r,t]),o?Object(V.jsx)(Ce,{}):Object(V.jsxs)("section",{className:"property__reviews reviews",children:[Object(V.jsx)(ye,{reviews:l,isLoadingError:u}),Object(V.jsx)(Te,{offerId:t,updateReviewsList:function(e){return i((function(t){return Object(M.a)(Object(M.a)({},t),{},{reviews:e,isLoadingError:!1})}))}})]})})),Fe={isFetching:!0,isError:!1,offer:null,nearbyOffers:[]},Ie=function(e,t){return Object(M.a)(Object(M.a)({},e),t)};var Pe=Object(l.b)((function(e){return{authorizationStatus:e.authorizationStatus}}),(function(e){return{fetchAllOffers:function(){e(D())}}}))((function(e){var t=e.fetchAllOffers,r=e.authorizationStatus,c=Object(a.useReducer)(Ie,Fe),s=Object(ee.a)(c,2),o=s[0],l=o.isFetching,u=o.isError,d=o.offer,j=o.nearbyOffers,b=s[1],p=Object(i.h)().id,m=Object(a.useCallback)(Object(X.a)(Q.a.mark((function e(){var t,r,a,n;return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([G(p),B(p)]);case 3:t=e.sent,r=Object(ee.a)(t,2),a=r[0],n=r[1],b({isFetching:!1,offer:a,nearbyOffers:n}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),b({isFetching:!1,isError:!0});case 13:case"end":return e.stop()}}),e,null,[[0,10]])}))),[p]),h=Object(a.useCallback)((function(){m()}),[m]);Object(a.useEffect)((function(){m()}),[m]);var O=Object(a.useMemo)((function(){var e=[d];return e=j.length>3?[].concat(Object(le.a)(e),Object(le.a)(j.slice(0,3))):[].concat(Object(le.a)(e),Object(le.a)(j))}),[j,d]),_=Object(i.g)(),f=Object(a.useCallback)(function(){var e=Object(X.a)(Q.a.mark((function e(a){return Q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),r===P&&_.push(R),e.next=4,Y(d.id,Number(!d.isFavorite));case 4:setTimeout((function(){m(),t()}),300);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[_,d,r,m,t]);return Object(V.jsxs)(n.a.Fragment,{children:[Object(V.jsx)(J,{}),Object(V.jsx)("div",{style:{display:"none"},children:Object(V.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",children:[Object(V.jsx)("symbol",{id:"icon-arrow-select",viewBox:"0 0 7 4",children:Object(V.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0 0l3.5 2.813L7 0v1.084L3.5 4 0 1.084V0z"})}),Object(V.jsx)("symbol",{id:"icon-bookmark",viewBox:"0 0 17 18",children:Object(V.jsx)("path",{d:"M3.993 2.185l.017-.092V2c0-.554.449-1 .99-1h10c.522 0 .957.41.997.923l-2.736 14.59-4.814-2.407-.39-.195-.408.153L1.31 16.44 3.993 2.185z"})}),Object(V.jsx)("symbol",{id:"icon-star",viewBox:"0 0 13 12",children:Object(V.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.5 9.644L10.517 12 9.451 7.56 13 4.573l-4.674-.386L6.5 0 4.673 4.187 0 4.573 3.549 7.56 2.483 12 6.5 9.644z"})})]})}),l&&Object(V.jsx)(ie,{}),u&&Object(V.jsxs)("div",{children:["Offer with id ",p," not found"]}),!u&&!l&&Object(V.jsx)("div",{className:"page",children:Object(V.jsxs)("main",{className:"page__main page__main--property",children:[Object(V.jsxs)("section",{className:"property",children:[Object(V.jsx)("div",{className:"property__gallery-container container",children:Object(V.jsx)("div",{className:"property__gallery",children:(d.images.length>6?Object(le.a)(d.images.slice(0,6)):d.images).map((function(e){return Object(V.jsx)("div",{className:"property__image-wrapper",children:Object(V.jsx)("img",{className:"property__image",src:e,alt:"studio"})},e)}))})}),Object(V.jsx)("div",{className:"property__container container",children:Object(V.jsxs)("div",{className:"property__wrapper",children:[d.isPremium&&Object(V.jsx)("div",{className:"property__mark",children:Object(V.jsx)("span",{children:"Premium"})}),Object(V.jsxs)("div",{className:"property__name-wrapper",children:[Object(V.jsx)("h1",{className:"property__name",children:d.title}),Object(V.jsxs)("button",{className:"property__bookmark-button ".concat(d.isFavorite?"property__bookmark-button--active":""," button"),type:"button",onClick:f,children:[Object(V.jsx)("svg",{className:"property__bookmark-icon",width:"31",height:"33",children:Object(V.jsx)("use",{xlinkHref:"#icon-bookmark"})}),Object(V.jsx)("span",{className:"visually-hidden",children:"To bookmarks"})]})]}),Object(V.jsxs)("div",{className:"property__rating rating",children:[Object(V.jsxs)("div",{className:"property__stars rating__stars",children:[Object(V.jsx)("span",{style:{width:"".concat(ae(d.rating),"%")}}),Object(V.jsx)("span",{className:"visually-hidden",children:"Rating"})]}),Object(V.jsx)("span",{className:"property__rating-value rating__value",children:d.rating})]}),Object(V.jsxs)("ul",{className:"property__features",children:[Object(V.jsx)("li",{className:"property__feature property__feature--entire",children:d.type}),Object(V.jsxs)("li",{className:"property__feature property__feature--bedrooms",children:[d.bedrooms," Bedrooms"]}),Object(V.jsxs)("li",{className:"property__feature property__feature--adults",children:["Max ",d.maxAdults," adults"]})]}),Object(V.jsxs)("div",{className:"property__price",children:[Object(V.jsxs)("b",{className:"property__price-value",children:["\u20ac",d.price]}),Object(V.jsx)("span",{className:"property__price-text",children:"\xa0night"})]}),Object(V.jsxs)("div",{className:"property__inside",children:[Object(V.jsx)("h2",{className:"property__inside-title",children:"What's inside"}),Object(V.jsx)("ul",{className:"property__inside-list",children:d.goods.map((function(e){return Object(V.jsx)("li",{className:"property__inside-item",children:e},e)}))})]}),Object(V.jsxs)("div",{className:"property__host",children:[Object(V.jsx)("h2",{className:"property__host-title",children:"Meet the host"}),Object(V.jsxs)("div",{className:"property__host-user user",children:[Object(V.jsx)("div",{className:"property__avatar-wrapper ".concat(d.host.isPro&&"property__avatar-wrapper--pro"," user__avatar-wrapper"),children:Object(V.jsx)("img",{className:"property__avatar user__avatar",src:d.host.avatarUrl,width:"74",height:"74",alt:"Host avatar"})}),Object(V.jsx)("span",{className:"property__user-name",children:d.host.name}),d.host.isPro&&Object(V.jsx)("span",{className:"property__user-status",children:"Pro"})]}),Object(V.jsx)("div",{className:"property__description",children:Object(V.jsx)("p",{className:"property__text",children:d.description})})]}),Object(V.jsx)("section",{className:"property__reviews reviews",children:Object(V.jsx)(Le,{offerId:p})})]})}),j.length>0&&Object(V.jsx)("section",{className:"property__map map",children:Object(V.jsx)(he,{city:d.city,points:O,activeCard:d})})]}),j.length>0&&Object(V.jsx)("div",{className:"container",children:Object(V.jsxs)("section",{className:"near-places places",children:[Object(V.jsx)("h2",{className:"near-places__title",children:"Other places in the neighbourhood"}),Object(V.jsx)("div",{className:"near-places__list places__list",children:Object(V.jsx)(ue,{offers:j,onFavoriteToggle:h})})]})})]})})]})}));var ze=function(e){return Object(V.jsxs)(n.a.Fragment,{children:[Object(V.jsx)("h2",{children:"This page does not exist"}),Object(V.jsx)(o.a,{to:"/",children:"To main page"})]})};var Ae=function(e){var t=e.cityName,r=e.currentCity,a=e.onClick;return Object(V.jsx)("li",{className:"locations__item",children:Object(V.jsx)(o.a,{className:"locations__item-link tabs__item ".concat(t===r&&"tabs__item--active"),to:"#",onClick:a,children:Object(V.jsx)("span",{children:t})})})};var Me=Object(l.b)((function(e){return{currentCity:e.currentCity}}),(function(e){return{changeCity:function(t){e(d(t))}}}))((function(e){var t=e.currentCity,r=e.changeCity;return Object(V.jsx)("ul",{className:"locations__list tabs__list",children:A.map((function(e){return Object(V.jsx)(Ae,{cityName:e,currentCity:t,onClick:function(){return r(e)}},e)}))})})),qe=r(29),He=Object(qe.a)((function(e){return e.currentCity}),(function(e){return e.offers}),(function(e,t){return t.filter((function(t){return t.city.name===e}))})),Ue=Object(qe.a)(He,(function(e){return e.currentSortType}),(function(e,t){switch(t){case N.PRICE_LOW_TO_HIGH:return e.slice().sort((function(e,t){return e.price-t.price}));case N.PRICE_HIGH_TO_LOW:return e.slice().sort((function(e,t){return t.price-e.price}));case N.TOP_RATED_FIRST:return e.slice().sort((function(e,t){return t.rating-e.rating}));default:return e}}));var De=Object(l.b)((function(e){return{offersCount:He(e).length,currentCity:e.currentCity}}))((function(e){var t=e.offersCount,r=e.currentCity;return Object(V.jsxs)(V.Fragment,{children:[Object(V.jsx)("h2",{className:"visually-hidden",children:"Places"}),Object(V.jsx)("b",{className:"places__found",children:"".concat(t," ").concat(1===t?"place":"places"," to stay in ").concat(r)})]})}));var Ge=Object(l.b)((function(e){return{currentSortType:e.currentSortType}}),(function(e){return{changeSortType:function(t){e(p(t))}}}))((function(e){var t=e.currentSortType,r=e.changeSortType,n=Object(a.useState)(null),c=Object(ee.a)(n,2),s=c[0],i=c[1],o=Object(a.useRef)(null);return Object(a.useEffect)((function(){var e=function(e){e.target.parentElement!==o.current&&i(!1)};return s&&document.addEventListener("click",e),function(){return s&&document.removeEventListener("click",e)}}),[s]),Object(V.jsxs)("form",{className:"places__sorting",action:"#",method:"get",children:[Object(V.jsx)("span",{className:"places__sorting-caption",children:"Sort by "}),Object(V.jsxs)("span",{className:"places__sorting-type",tabIndex:"0",onClick:function(){return i(!s)},children:[t,Object(V.jsx)("svg",{className:"places__sorting-arrow",width:"7",height:"4",children:Object(V.jsx)("use",{xlinkHref:"#icon-arrow-select"})})]}),Object(V.jsx)("ul",{className:"places__options places__options--custom ".concat(s&&"places__options--opened"),ref:o,children:Object.values(N).map((function(e){return Object(V.jsx)("li",{className:"places__option ".concat(e===t&&"places__option--active"),tabIndex:"0",onClick:function(){return r(e)},children:e},e)}))})]})}));var Be=Object(l.b)((function(e){return{offers:Ue(e),currentCity:e.currentCity}}))((function(e){var t=e.offers,r=e.currentCity,c=Object(a.useState)(null),s=Object(ee.a)(c,2),i=s[0],o=s[1],l=0===t.length;return Object(V.jsxs)(n.a.Fragment,{children:[Object(V.jsx)("div",{style:{display:"none"},children:Object(V.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",children:[Object(V.jsx)("symbol",{id:"icon-arrow-select",viewBox:"0 0 7 4",children:Object(V.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0 0l3.5 2.813L7 0v1.084L3.5 4 0 1.084V0z"})}),Object(V.jsx)("symbol",{id:"icon-bookmark",viewBox:"0 0 17 18",children:Object(V.jsx)("path",{d:"M3.993 2.185l.017-.092V2c0-.554.449-1 .99-1h10c.522 0 .957.41.997.923l-2.736 14.59-4.814-2.407-.39-.195-.408.153L1.31 16.44 3.993 2.185z"})}),Object(V.jsx)("symbol",{id:"icon-star",viewBox:"0 0 13 12",children:Object(V.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.5 9.644L10.517 12 9.451 7.56 13 4.573l-4.674-.386L6.5 0 4.673 4.187 0 4.573 3.549 7.56 2.483 12 6.5 9.644z"})})]})}),Object(V.jsx)("div",{className:"page page--gray page--main ".concat(l?"page__main--index-empty":""),children:Object(V.jsxs)("main",{className:"page__main page__main--index",children:[Object(V.jsx)("h1",{className:"visually-hidden",children:"Cities"}),Object(V.jsx)("div",{className:"tabs",children:Object(V.jsx)("section",{className:"locations container",children:Object(V.jsx)(Me,{})})}),Object(V.jsxs)("div",{className:"cities",children:[l&&Object(V.jsxs)("div",{className:"cities__places-container cities__places-container--empty container",children:[Object(V.jsx)("section",{className:"cities__no-places",children:Object(V.jsxs)("div",{className:"cities__status-wrapper tabs__content",children:[Object(V.jsx)("b",{className:"cities__status",children:"No places to stay available"}),Object(V.jsxs)("p",{className:"cities__status-description",children:["We could not find any property available at the moment in ",r," "]})]})}),Object(V.jsx)("div",{className:"cities__right-section"})]}),!l&&Object(V.jsxs)("div",{className:"cities__places-container container",children:[Object(V.jsxs)("section",{className:"cities__places places",children:[Object(V.jsx)(De,{}),Object(V.jsx)(Ge,{}),Object(V.jsx)(ue,{offers:t,onHover:function(e){o(e)}})]}),Object(V.jsx)("div",{className:"cities__right-section",children:Object(V.jsx)("section",{className:"cities__map map",children:Object(V.jsx)(he,{city:t[0].city,points:t,activeCard:i})})})]})]})]})})]})}));var We=function(){return Object(V.jsxs)("div",{className:"page page--gray page--main",children:[Object(V.jsx)(J,{}),Object(V.jsx)(Be,{})]})},Ye=r(10),Ve=Object(Ye.a)();var Je=Object(l.b)((function(e){return{authorizationStatus:e.authorizationStatus}}))((function(e){var t=e.render,r=e.path,a=e.exact,n=e.authorizationStatus;return Object(V.jsx)(i.b,{path:r,exact:a,render:function(e){return n===I?t(e):Object(V.jsx)(i.a,{to:R})}})}));var Ze=Object(l.b)((function(e){return{isDataLoaded:e.isDataLoaded,authorizationStatus:e.authorizationStatus,isAppError:e.isAppError}}))((function(e){var t=e.isDataLoaded,r=e.authorizationStatus,a=e.isAppError,n=r!==z;return a?Object(V.jsx)("div",{children:"Api unavailable"}):t&&n?Object(V.jsx)(i.c,{history:Ve,children:Object(V.jsxs)(i.d,{children:[Object(V.jsx)(i.b,{path:w,exact:!0,component:We}),Object(V.jsx)(i.b,{path:"/login",exact:!0,render:function(){return r===P?Object(V.jsx)(K,{}):Object(V.jsx)(i.a,{to:w})}}),Object(V.jsx)(Je,{exact:!0,path:S,render:function(){return Object(V.jsx)(oe,{})}}),Object(V.jsx)(i.b,{path:"".concat(k,"/:id"),children:Object(V.jsx)(Pe,{})}),Object(V.jsx)(i.b,{children:Object(V.jsx)(ze,{})})]})}):Object(V.jsx)(ie,{})})),Ke={currentCity:A[3],offers:[],isDataLoaded:!1,authorizationStatus:P,userInfo:{},currentSortType:N.POPULAR,isAppError:!1},$e=r(17),Qe=r(38),Xe=r(39),et=r(40),tt=r.n(et),rt=401,at=500,nt=function(e,t){var r=tt.a.create({baseURL:"https://7.react.pages.academy/six-cities",timeout:5e3});return r.interceptors.response.use((function(e){return e}),(function(r){var a=r.response;throw a.status===rt&&e(),a.status>=at&&t(),r})),r.interceptors.request.use((function(e){var t;return e.headers={"x-token":null!==(t=localStorage.getItem("token"))&&void 0!==t?t:""},e})),r}((function(){return ct.dispatch(W())}),(function(){return ct.dispatch(_())})),ct=Object($e.createStore)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ke,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case u.CHANGE_CITY:return Object(M.a)(Object(M.a)({},e),{},{currentCity:t.payload});case u.SET_OFFERS:return Object(M.a)(Object(M.a)({},e),{},{offers:t.payload,isDataLoaded:!0});case u.SET_OFFERS_FAIL:return Object(M.a)(Object(M.a)({},e),{},{isDataLoaded:!0});case u.CHANGE_SORT_TYPE:return Object(M.a)(Object(M.a)({},e),{},{currentSortType:t.payload});case u.LOGIN:return Object(M.a)(Object(M.a)({},e),{},{authorizationStatus:I,userInfo:t.payload});case u.LOGOUT:return Object(M.a)(Object(M.a)({},e),{},{authorizationStatus:P,userInfo:Ke.userInfo});case u.SET_APP_ERROR:return Object(M.a)(Object(M.a)({},e),{},{isAppError:!0});default:return e}}),Object(Xe.composeWithDevTools)(Object($e.applyMiddleware)(Qe.a.withExtraArgument(nt)),Object($e.applyMiddleware)((function(e){return function(e){return function(t){return t.type===u.REDIRECT_TO_ROUTE&&Ve.push(t.payload),e(t)}}}))));ct.dispatch((function(e,t,r){return r.get(T).then((function(t){var r=t.data;e(h(U(r)))}))})),ct.dispatch(D()),s.a.render(Object(V.jsx)(n.a.StrictMode,{children:Object(V.jsx)(l.a,{store:ct,children:Object(V.jsx)(Ze,{})})}),document.getElementById("root"))}},[[71,1,2]]]);
//# sourceMappingURL=main.13b483fe.chunk.js.map